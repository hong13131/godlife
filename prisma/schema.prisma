generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Supabase Auth를 쓸 때, auth.users(id)와 매핑되는 user.authUserId를 사용합니다.
model User {
  id          String        @id @default(uuid())
  authUserId  String        @unique
  email       String        @unique
  name        String?
  avatarUrl   String?
  role        UserRole      @default(MEMBER)
  teamId      String?
  team        Team?         @relation(fields: [teamId], references: [id])
  goals       Goal[]
  badges      Badge[]
  activityLog ActivityLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Team {
  id         String @id @default(uuid())
  name       String
  inviteCode String @unique
  users      User[]
  goals      Goal[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Goal {
  id          String     @id @default(uuid())
  userId      String
  teamId      String?
  title       String
  category    String?
  targetCount Int
  unit        String
  month       DateTime // 해당 월의 1일 기준
  startDate   DateTime?
  endDate     DateTime?
  notes       String?
  status      GoalStatus @default(ACTIVE)

  user   User    @relation(fields: [userId], references: [id])
  team   Team?   @relation(fields: [teamId], references: [id])
  checks Check[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Check {
  id     String   @id @default(uuid())
  goalId String
  date   DateTime
  value  Int      @default(1) // 일 단위 체크 횟수 (기본 1)

  goal Goal @relation(fields: [goalId], references: [id])

  createdAt DateTime @default(now())

  @@unique([goalId, date])
}

model Badge {
  id        String   @id @default(uuid())
  userId    String
  type      String
  awardedAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model ActivityLog {
  id        String   @id @default(uuid())
  userId    String
  type      String // 예: GOAL_CREATED, CHECK_ADDED, GOAL_COMPLETED
  meta      Json?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

enum UserRole {
  ADMIN
  MEMBER
}

enum GoalStatus {
  ACTIVE
  COMPLETED
  ARCHIVED
}
